<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prospective</title>
    <script type="text/javascript" >
      (function(s,u,r,f,l,y){s[f]=s[f]||{init:function(){s[f].q=arguments}};
        l=u.createElement(r);y=u.getElementsByTagName(r)[0];l.async=1;
        l.src='https://surfly.com/surfly.js';y.parentNode.insertBefore(l,y);})
      (window,document,'script','Surfly');

      var settings = {
        // Surfly session options can be set here, or at the Company/Plan levels.
        widget_key:'41d155addbc0416fa1a884eb8d33f9c8',
      };

      Surfly.init(settings, function(initResult) {
        if (initResult.success) {
          // API calls can now be made!
          if (!Surfly.isInsideSession) {
            //Surfly.button();
          }
        }
        else{
          console.log("Surfly was unable to initialize properly.")
        }
      });

      function onClickSessionStart(e) {
        console.log("seconde link");
        const session = Surfly.session({docked_only: true}).startLeader();
        const fLink = session.followerLink;
        console.log("session",session);
        console.log("Follower Link --", fLink);
      }

      // Get the followerLink provide in the input from the user
      function getFollowerLink() {
        var linkInput = document.getElementById("followerLinkInput");
        return linkInput.value;
      }

      // Start a Leader session and generate a followerLink
      function startLeaderSession() {
        const session = Surfly.session({docked_only: true})
        // these handlers will only be called for this particular session
          .on('session_started', function(session) {
            console.log(session, 'is fully initiated');
            console.log("session.followerLink", session.followerLink);
          })
          .on('viewer_joined', function(session, event) {
            console.log('there are', event.count, 'users in total');
          })
          .startLeader();

        setTimeout(function(){console.log("timeout---",session.followerLink)},3000);
        const fLink = session.followerLink;
        console.log("session",session);
        console.log("Follower Link --", fLink);
        return fLink;
      }

      // Start a followerSession using the provided followerLink and
      // establish a session between the Leader and the Follower
      function startFollowerSession(followerLink) {
        const session = Surfly.session({}, followerLink);
        session.startFollower(null, {name: 'John Doe', foo: 'bar'});
        return session;
      }

      function startCobrowsingSession() {
        const followerLink = getFollowerLink(); // Get this link from input
       // if (followerLink) {
          startFollowerSession(followerLink);
        /*} else {
          // Start a Leader session instead
          const followerLink = startLeaderSession();
        }*/
        // Pass the followerLink to another user
      }
    </script>
    <script>
      function writeToSheet() {
        var params = {
          // The ID of the spreadsheet to update.
          spreadsheetId: '1F5Lj-Saw7bKH1OSOMJ0g4jD9tvXk_teva04nVFTYRx8',  // TODO: Update placeholder value.

          // The A1 notation of the values to update.
          range: 'Sheet1',  // TODO: Update placeholder value.

          // How the input data should be interpreted.
          valueInputOption: 'RAW',  // TODO: Update placeholder value.
        };
        var linkInput = document.getElementById("followerLinkInput");

        var valueRangeBody = {
          // TODO: Add desired properties to the request body. All existing properties
          // will be replaced.
          //"range": "string",
          // "majorDimension" :"COLUMNS",
          "values": [
            [ 'prospective'], [linkInput.value]
          ]
        };

        var request = gapi.client.sheets.spreadsheets.values.update(params, valueRangeBody);
        request.then(function(response) {
          // TODO: Change code below to process the `response` object:
          console.log(response.result);
        }, function(reason) {
          console.error('error: ' + reason.result.error.message);
        });
      }
      function readFromSheet() {
        var params = {
          spreadsheetId: '1F5Lj-Saw7bKH1OSOMJ0g4jD9tvXk_teva04nVFTYRx8',  // TODO: Update placeholder value.
          range: 'Sheet1',  // TODO: Update placeholder value.
        };

        var request = gapi.client.sheets.spreadsheets.values.get(params);
        request.then(function(response) {
          console.log("response",response.result.values);
          console.log("response actual",response.result.values);
          console.log("filter from array",response.result.values[0],response.result.values[1]);
          if(response.result.values[0] == "advisor" && response.result.values[1] != "" && response.result.values[1] != undefined ){
            console.log("calling surfly api from prospective");
          }
        }, function(reason) {
          console.error('error: ' + reason.result.error.message);
        });
      }

      function initClient() {
        var API_KEY = 'AIzaSyBjzwt8KlslI0rKpWbFORdKrkL2GoHo_zA';  // TODO: Update placeholder with desired API key.

        var CLIENT_ID = '895692538348-n2qk8b174io4gp98ppqnanrbjb3t1dcl.apps.googleusercontent.com';  // TODO: Update placeholder with desired client ID.

        var SCOPE = 'https://www.googleapis.com/auth/spreadsheets.readonly';

        gapi.client.init({
          'apiKey': API_KEY,
          'clientId': CLIENT_ID,
          'scope': SCOPE,
          'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
        }).then(function() {
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
          updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        });
      }

      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      function updateSignInStatus(isSignedIn) {
        if (isSignedIn) {
          //makeApiCall();
        }
        else{
          console.log("please sign in");
          alert("please sign in with google");
        }
      }

      function handleSignInClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      function handleSignOutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }
    </script>
    <script async defer src="https://apis.google.com/js/api.js"
            onload="this.onload=function(){};handleClientLoad()"
            onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <link rel="stylesheet" href="style2.css" type="text/css">
    <script type="text/javascript" >
      setInterval(
        function(){
          var response = readFromSheet();
          console.log("timeinterval response",response);
        },
        3000);
    </script>
</head>
<body>
<h1>Prospective</h1>
<div class="container">
    <form action="#">
        <label for="followerLinkInput"><b>follower Link</b></label>
        <input  type="text" id="followerLinkInput" name="firstname" placeholder="Your name..">

        <label for="lname"><b>Last Name</b></label>
        <input type="text" id="lname" name="lastname" placeholder="Your last name..">

        <div id="gender">
            <b>Gender:</b>
            <label for="male">Male</label>
            <input type="radio" id="male" name="gender" >
            <label for="female">Female</label>
            <input type="radio" id="female" name="gender" >
            <label for="other">Other</label>
            <input type="radio" id="other" name="gender" ><br/>
        </div>

        <div id="maritalStatus">
            <b>Marital Status:</b>
            <label for="married">Married</label>
            <input type="radio" id="married" name="maritalStatus" >
            <label for="unmarried">Unmarried</label>
            <input type="radio" id="unmarried" name="maritalStatus" >
        </div>

        <label for="country"><b>Country</b></label>
        <select id="country" name="country">
            <option value="australia">Australia</option>
            <option value="india">India</option>
            <option value="usa">USA</option>
        </select>

        <label for="subject"><b>About yourself</b></label>
        <textarea id="subject" name="subject" placeholder="Write something.." style="height:200px"></textarea>

        <input type="submit" value="Submit">
        <span class="secondLink" onclick="startCobrowsingSession()" >Second link</span>
        <!--<span class="secondLink" onclick="writeToSheet()" >writeData</span>
        <span class="secondLink" onclick="readFromSheet()" >ReadData</span>-->
        <a href="#surflystart" id="cobrowse" >Show Co-Browse Code</a>
    </form>
</div>
</body>
</html>
